# Co-op Source Network — Environment Variables
# Copy to .env and fill in your values.
#
# Stage 0-1 (local, self-hosted):  all vars in this file are sufficient
# Stage 2+ (federated, ATProto):   see docs/stage2-env.md (not yet written)

# ─── Server ──────────────────────────────────────────────────────────────────

NODE_ENV=development          # development | production
PORT=3001                     # API server port (web expects this)

# ─── Database ────────────────────────────────────────────────────────────────

# PostgreSQL connection string.
# Dev default matches docker-compose.yml — change user/pass/host for production.
DATABASE_URL=postgresql://coopsource:dev_password@localhost:5432/coopsource_dev

# ─── Session ─────────────────────────────────────────────────────────────────

# Secret for signing session cookies. Must be long and random in production.
# Generate: node -e "console.log(require('crypto').randomBytes(48).toString('base64'))"
SESSION_SECRET=change-me-in-production

# ─── ATProto / PLC Directory ─────────────────────────────────────────────────

# 'local' = use DB-backed LocalPlcClient (no external service needed, Stage 0-1)
# Any URL = use real PLC directory (e.g. https://plc.directory for Stage 2+)
PLC_URL=local

# Public URL of this instance (used in DID documents and PDS records).
# Must be reachable from the internet in Stage 2+.
INSTANCE_URL=http://localhost:3001

# Key encryption key for signing keys stored in DB.
# Generate: node -e "console.log(require('crypto').randomBytes(32).toString('base64'))"
KEY_ENC_KEY=replace-with-32-bytes-base64-encoded

# ─── Blob Storage ────────────────────────────────────────────────────────────

# Directory for uploaded files (avatars, attachments).
# Relative to the api app root, or use an absolute path.
BLOB_DIR=./data/blobs

# ─── Email ───────────────────────────────────────────────────────────────────

# SMTP host for sending invitation emails, notifications, etc.
# Dev default: Mailpit (start with: pnpm dev:infra — see docker-compose.yml)
# View captured dev emails at: http://localhost:8025
SMTP_HOST=localhost
SMTP_PORT=1025

# Production SMTP credentials (not needed in dev with Mailpit)
# SMTP_USER=your-smtp-username
# SMTP_PASS=your-smtp-password
# SMTP_FROM=noreply@yourcoopsource.example

# ─── Frontend ────────────────────────────────────────────────────────────────

# API URL used by the SvelteKit server-side code (hooks.server.ts, load fns).
# In production, both API and web are behind the same reverse proxy — use internal URL.
API_URL=http://localhost:3001

# API URL used by the browser (client-side fetches — currently display-only).
# In production, this is the public URL.
VITE_API_URL=http://localhost:3001

# ─── Redis (optional in Stage 0-1) ───────────────────────────────────────────

# Redis is not required for Stage 0-1 but is in the dev stack.
# In Stage 2+ it's used for rate limiting and pub/sub.
REDIS_URL=redis://localhost:6379

# ─── Stage 2: ATProto PDS ───────────────────────────────────────────────────

# Real ATProto PDS URL. When set, AtprotoPdsService is used instead of LocalPdsService.
# Leave unset/empty in Stage 0-1 to use the DB-backed local PDS.
# PDS_URL=http://localhost:2583
# PDS_ADMIN_PASSWORD=admin
# PDS_JWT_SECRET=dev-jwt-secret-change-me-32chars!!

# Real PLC directory URL (used by PDS container).
# PLC_URL=http://localhost:2582

# ─── Stage 2+ Only ─────────────────────────────────────────────────────────

# ATProto OAuth (needed when switching to real @atproto/pds)
# OAUTH_CLIENT_ID=
# OAUTH_PRIVATE_KEY=

# External service integrations (GitHub, Google, Slack, etc.)
# GITHUB_CLIENT_ID=
# GITHUB_CLIENT_SECRET=
# GOOGLE_CLIENT_ID=
# GOOGLE_CLIENT_SECRET=

# AI (Claude — for Stage 3 automation/agent features)
# ANTHROPIC_API_KEY=sk-ant-...
